<dashboard version="1.1">
  <label>CP-SOC - Correlation</label>
  <row>
    <panel>
      <title>Correlated Windows (Motion + Tamper)</title>
      <table>
        <search>
          <query>index=iot (sourcetype=iot:pir:json OR sourcetype=iot:mpu:json) | eval bucket=_time - (_time % 120) | stats max(eval(event_type="iot.motion.detected")) as has_motion max(eval(event_type="iot.device.tamper")) as has_tamper values(sensor) as sensors by location host bucket | where has_motion=1 AND has_tamper=1 | eval window_start=strftime(bucket, "%Y-%m-%d %H:%M:%S") | table window_start location host sensors</query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
      </table>
    </panel>
  </row>
</dashboard>
